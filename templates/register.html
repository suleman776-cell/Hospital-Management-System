{% extends 'base.html' %}
{% block content %}
<div class="card" style="max-width: 800px; margin: 0 auto;">
    <div class="card-header">
        <i class="fas fa-procedures"></i> Patient Registration (BST Insertion)
    </div>
    <div class="card-body">
        
        {% if not pid %}
        <form method="POST" class="mb-4">
            <h4 class="mb-3">Patient Details</h4>
            
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Full Name</label>
                    <input name="name" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Age</label>
                    <input name="age" type="number" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Priority (1=High)</label>
                    <select name="priority" class="form-select">
                        <option value="5">5 - Routine Checkup</option>
                        <option value="4">4 - Low Priority</option>
                        <option value="3">3 - Standard Urgent (Auto ER)</option>
                        <option value="2">2 - High Urgency (Auto ER)</option>
                        <option value="1">1 - CRITICAL / Life Threat (Auto ER)</option>
                    </select>
                </div>
            </div>
            
            <div class="row g-3 mb-4">
                <div class="col-md-8">
                    <label class="form-label">Primary Complaint / Disease</label>
                    <select name="disease" class="form-select" required>
                        <option value="">-- Select Complaint --</option>
                        {% for disease, spec in disease_map.items() %}
                            <option value="{{ disease }}">{{ disease }} ({{ spec }})</option>
                        {% endfor %}
                        <option value="Other">Other / General Medicine</option>
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <div class="form-check form-switch p-0">
                        <input type="checkbox" name="emergency" class="form-check-input ms-0" id="erCheck" role="switch">
                        <label class="form-check-label text-danger fw-bold ms-2" for="erCheck">
                            <i class="fas fa-first-aid me-1"></i> Force Emergency
                        </label>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-stethoscope me-2"></i> Register & Find Specialist
            </button>
        </form>
        {% endif %}

        {% if pid %}
        <hr>
        <div class="alert alert-success mt-4">
            Patient successfully registered! **Patient ID: {{ pid }}** is created.
        </div>
        
        <h4 class="mt-4">
            <i class="fas fa-user-tag me-2"></i> Specialist Suggestion: <span class="badge badge-specialist">{{ spec }}</span>
        </h4>

        {% if doctors %}
        <form method="POST" action="/book_appointment" class="mt-3">
            <input type="hidden" name="pid" value="{{ pid }}">
            
            <div class="mb-3">
                <label class="form-label">Choose Available Doctor</label>
                <select name="doctor_id" class="form-select" required>
                    {% for d in doctors %}
                        <option value="{{ d.id }}">{{ d.name }} â€” ID: {{ d.id }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Preferred Time (Optional)</label>
                <input name="time" type="time" class="form-control" placeholder="e.g. 10:00">
            </div>
            
            <button class="btn btn-success w-100">
                <i class="fas fa-calendar-alt me-2"></i> Book Specialist Appointment
            </button>
        </form>
        {% else %}
        <div class="alert alert-warning mt-3">
            No doctors available for **{{ spec }}** specialization right now. Patient placed in general waiting list.
        </div>
        {% endif %}
        {% endif %}
        
    </div>
</div>
{% endblock %}